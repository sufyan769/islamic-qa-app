<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>البحث في الكتب الإسلامية</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; direction: rtl; }
    input, button { font-size: 18px; padding: 10px; margin-top: 10px; width: 100%; }
    .result { background: #fff; padding: 10px; margin: 10px 0; border-radius: 8px; box-shadow: 0 0 3px #ccc; }
    .question { font-weight: bold; margin-top: 20px; cursor: pointer; color: #0066cc; }
    .link { font-size: 12px; color: gray; }
  </style>
</head>
<body>
  <h2>اسأل عن أي مسألة في الكتب الإسلامية</h2>
  <input type="text" id="searchInput" placeholder="اكتب سؤالك هنا...">
  <button onclick="search()">بحث</button>

  <div id="results"></div>

  <h3>أسئلة سابقة:</h3>
  <div id="previous"></div>

  <script>
    async function search() {
      const q = document.getElementById("searchInput").value.trim();
      if (!q) return;

      const response = await fetch(`/ask?q=${encodeURIComponent(q)}&mode=default`);
      if (!response.ok) {
        alert("حدث خطأ في البحث.");
        return;
      }
      const data = await response.json();

      const resultsDiv = document.getElementById("results");
      resultsDiv.innerHTML = "";

      if (data.claude_answer) {
        resultsDiv.innerHTML += `<div class='result'><b>الجواب المختصر:</b><br>${data.claude_answer}</div>`;
      }

      (data.sources_retrieved || []).forEach(doc => {
        const link = `/doc/${doc.id}`;
        resultsDiv.innerHTML += `
          <div class='result'>
            <b>${doc.book_title}</b> - ${doc.author_name}<br>
            [جـ ${doc.part_number}، صـ ${doc.page_number}]<br>
            <div>${doc.text_content}</div>
            <div class='link'>رابط دائم: <a href='${link}'>${link}</a></div>
          </div>`;
      });
    }

    // تحميل الأسئلة السابقة
    async function loadPrevious() {
      const res = await fetch("/ask?q=الكلمة&mode=ai_only");
      if (!res.ok) return;
      const data = await res.json();
      const container = document.getElementById("previous");
      (data.previous_questions || []).forEach(q => {
        const div = document.createElement("div");
        div.className = "question";
        div.textContent = q;
        div.onclick = () => { document.getElementById("searchInput").value = q; search(); };
        container.appendChild(div);
      });
    }
    loadPrevious();
  </script>
</body>
</html>
